(function(){window.MapApp={Models:{},Collections:{},Views:{}};window.template=function(e){return _.template($("#"+e).html())};var e=_.extend({},Backbone.Events);MapApp.Router=Backbone.Router.extend({routes:{"":"index","show/:id":"show",showAll:"showAll","add/:id/*title":"add","search/*title":"search","*other":"Default"},index:function(){console.log("index")},show:function(t){console.log("show:"+t);e.trigger("ort:show",t)},showAll:function(t){e.trigger("ort:showAll",t)},add:function(e,t){console.log("add id:"+e+" title:"+t)},search:function(e){console.log("search title:"+e)},Default:function(e){console.log("Not sure wht you tying to do: you acessed:"+e)}});MapApp.router=new MapApp.Router;Backbone.history.start();MapApp.Models.Ort=Backbone.Model.extend({defaults:{title:"Ich bin der Default Titel",lat:51.511214,lon:-0.119824,html:"ich bin der Default HTML Inhalt"},sync:function(){return!1},validate:function(e){if(!_.isNumber(e.lat))return"lat Must not be empty";if(!_.isNumber(e.lon))return"lon Must not be empty";if(!$.trim(e.title))return"title Must not be empty"},display:function(){return this.get("title")+" is displaying"}});MapApp.Collections.Orte=Backbone.Collection.extend({model:MapApp.Models.Ort});MapApp.Views.Orte=Backbone.View.extend({tagName:"ul",initialize:function(){this.collection.on("add",this.addOne,this)},render:function(){this.collection.each(this.addOne,this);return this},addOne:function(e){var t=new MapApp.Views.Ort({model:e});this.$el.append(t.render().el)}});MapApp.Views.Ort=Backbone.View.extend({tagName:"li",className:"ort",events:{"click strong":"showAlert","click button":"destroy"},template:template("ortTemplate"),initialize:function(){this.model.on("change",this.render,this);this.model.on("destroy",this.remove,this)},render:function(){this.$el.html(this.template(this.model.toJSON()));e.trigger("change");return this},showAlert:function(){var e=prompt("edit the Title:",this.model.get("title"));if(!e)return;this.model.set("title",e)},destroy:function(){this.model.destroy()},remove:function(){this.$el.remove()}});MapApp.Views.Map=Backbone.View.extend({el:"#mapActions",events:{"click #showAll":"showAll","click #removeAll":"removeAll"},initialize:function(){e.on("ort:showAll",this.showAll,this);e.on("change",this.showAll,this);this.collection.on("add",this.showAll,this);this.collection.on("remove",this.showAll,this)},showAll:function(){this.removeAll();this.collection.each(this.showOrt,this)},removeAll:function(){MapApp.removeMarkers()},showOrt:function(e){console.log("showORT In MAP VIEW");var t=e.get("lat"),n=e.get("lon"),r=e.get("title"),i=e.get("html");MapApp.addLocationToMap(t,n,r,i)},destroyMarker:function(e){this.model.destroy()},remove:function(){this.$el.remove()}});MapApp.Views.AddOrt=Backbone.View.extend({el:"#addOrt",events:{submit:"submit"},initialize:function(){},submit:function(e){e.preventDefault();var t=$(e.currentTarget).find("input.title").val(),n=$(e.currentTarget).find("input.lat").val(),r=$(e.currentTarget).find("input.lon").val(),i=new MapApp.Models.Ort;i.set({title:t,lat:n,lon:r});this.collection.add(i)}});MapApp.orteCollection=new MapApp.Collections.Orte([{id:0,title:"Hamburg",lat:53.551085,lon:9.993682,html:"<strong>ich bin fett</strong> und jetzt nicht mehr"},{id:1,title:"Berlin",lat:52.519171,lon:13.406091,html:"<small>ich bin small</small> und jetzt nicht mehr"},{id:2,title:"Stockholm",lat:59.32893,lon:18.06491,html:"<h4>ich bin h4</h4> und jetzt nicht mehr"},{id:3,title:"Belin",lat:52.519171,lon:13.406091,html:"<small>ich bin small</small> und jetzt nicht mehr"},{id:4}]);var t=new MapApp.Views.Orte({collection:MapApp.orteCollection});$("#orteView").append(t.render().el);var n=new MapApp.Views.AddOrt({collection:MapApp.orteCollection});new MapApp.Views.Map({collection:MapApp.orteCollection});MapApp.addLocationToMap=function(e,t,n,r){MapApp.map.addMarker({lat:e,lng:t,title:n,click:function(e){},infoWindow:{content:n+": "+r}});return"marker added"};MapApp.removeMarkers=function(){MapApp.map.removeMarkers()};MapApp.map=new GMaps({div:"#map",lat:53.571148,lng:10.024898,zoom:3})})();