(function(){window.MapApp={Models:{},Collections:{},Views:{}};window.template=function(e){return _.template($("#"+e).html())};MapApp.addLocationToMap=function(e,t,n,r){MapApp.map.addMarker({lat:t,lng:n,title:r,html:"",click:function(e){},infoWindow:{content:$("#orteView .ort").eq(e).html()}});return"marker added"};MapApp.removeMarkers=function(){MapApp.map.removeMarkers()};MapApp.map=new GMaps({div:"#map",lat:53.571148,lng:10.024898,zoom:3});var e=_.extend({},Backbone.Events);MapApp.Router=Backbone.Router.extend({routes:{"":"index","show/:id":"show",showAll:"showAll","add/:id/*title":"add","search/*title":"search","*other":"Default"},index:function(){console.log("index")},show:function(t){console.log("show:"+t);e.trigger("ort:show",t)},showAll:function(t){e.trigger("ort:showAll",t)},add:function(e,t){console.log("add id:"+e+" title:"+t)},search:function(e){console.log("search title:"+e)},Default:function(e){console.log("Not sure wht you tying to do: you acessed:"+e)}});MapApp.router=new MapApp.Router;Backbone.history.start();MapApp.Models.Ort=Backbone.Model.extend({defaults:{title:"Ich bin der Default Titel",lat:51.511214,lon:-0.119824,logo:"http://lorempixel.com/80/80/people/",nationalCLC:"NationalCLC here",actionLines:"Action Lines here",eLLType:"Type of E&LL facility",link:"http://www.google.de"},sync:function(){return!1},validate:function(e){if(!_.isNumber(e.lat))return"lat Must not be empty";if(!_.isNumber(e.lon))return"lon Must not be empty";if(!$.trim(e.title))return"title Must not be empty"},display:function(){return this.get("title")+" is displaying"}});MapApp.Collections.Orte=Backbone.Collection.extend({filterType:function(e){return _(this.filter(function(t){return t.get("eLLType")==e}))},searchTitle:function(e){if(e=="")return this;var t=new RegExp(e,"gi");return _(this.filter(function(e){return t.test(e.get("title"))}))},model:MapApp.Models.Ort});MapApp.Views.Orte=Backbone.View.extend({tagName:"div",events:{"keyup #searchTitle":"search","change #filterType":"filterType"},initialize:function(){this.collection.on("add",this.addOne,this)},render:function(){this.collection.each(this.addOne,this);return this},addOne:function(e){var t=new MapApp.Views.Ort({model:e});this.$el.append(t.render().el)},search:function(e){var t=$("#searchTitle").val();this.render(this.collection.searchTitle(t))},filterType:function(e){var t=$("#llType").find("option:selected").val();t==""&&(status=0);this.render(this.collection.filterType(t))}});MapApp.Views.Ort=Backbone.View.extend({tagName:"div",className:"ort",events:{click:"showOrtInMap","click strong":"showAlert","click button":"destroy"},template:template("ortTemplate"),initialize:function(){this.model.on("change",this.render,this);this.model.on("destroy",this.remove,this)},render:function(){this.$el.html(this.template(this.model.toJSON()));e.trigger("change");return this},showAlert:function(){var e=prompt("edit the Title:",this.model.get("title"));if(!e)return;this.model.set("title",e)},destroy:function(){this.model.destroy()},remove:function(){this.$el.remove()},showOrtInMap:function(){console.log(this.model.get("id"));var e=this.model.get("lat"),t=this.model.get("lon");MapApp.map.setCenter(e,t);MapApp.map.setZoom(6)}});MapApp.Views.Map=Backbone.View.extend({el:"#mapActions",events:{"click #showAll":"showAll","click #removeAll":"removeAll"},initialize:function(){e.on("ort:showAll",this.showAll,this);e.on("change",this.showAll,this);this.collection.on("add",this.showAll,this);this.collection.on("remove",this.showAll,this);this.showAll()},showAll:function(){this.removeAll();this.collection.each(this.showOrt,this)},removeAll:function(){MapApp.removeMarkers()},showOrt:function(e){console.log("showORT In MAP VIEW");var t=e.get("lat"),n=e.get("lon"),r=e.get("title"),i=e.get("logo"),s=e.get("id"),o=e.get("nationalCLC"),u=e.get("actionLines"),a=e.get("eLLType"),f=e.get("link");MapApp.addLocationToMap(s,t,n,r)},destroyMarker:function(e){this.model.destroy()},remove:function(){this.$el.remove()}});MapApp.Views.AddOrt=Backbone.View.extend({el:"#addOrt",events:{submit:"submit"},initialize:function(){},submit:function(e){e.preventDefault();var t=$(e.currentTarget).find("input.title").val(),n=$(e.currentTarget).find("input.lat").val(),r=$(e.currentTarget).find("input.lon").val(),i=new MapApp.Models.Ort;i.set({title:t,lat:n,lon:r});this.collection.add(i)}});MapApp.orteCollection=new MapApp.Collections.Orte([{id:0,title:"Experience & Living Lab Hamburg",lat:53.551085,lon:9.993682,html:"<strong>ich bin fett</strong> und jetzt nicht mehr",logo:"http://lorempixel.com/g/80/80/nature/",nationalCLC:"Berlin",actionLines:"Computing in the Cloud, Smart Energy Systems",eLLType:"Office",link:"http://www.google.de"},{id:1,title:"Experience & Living Lab Berlin",lat:52.519171,lon:13.406091,html:"<small>ich bin small</small> und jetzt nicht mehr",logo:"http://lorempixel.com/g/80/80/sports/",nationalCLC:"Trento",actionLines:"Networking Solutions for Future Media",eLLType:"Office",link:"http://www.google.de"},{id:2,title:"Experience & Living Lab Stockholm",lat:59.32893,lon:18.06491,html:"<h4>ich bin h4</h4> und jetzt nicht mehr",logo:"http://lorempixel.com/g/80/80/cats/",nationalCLC:"Helsinki",actionLines:"Computing in the Cloud,Smart Spaces",eLLType:"Office",link:"http://www.google.de"},{id:3,title:"Experience & Living Lab Berlin",lat:52.519171,lon:13.406091,html:"<small>ich bin small</small> und jetzt nicht mehr",logo:"http://lorempixel.com/g/80/80/abstract/",nationalCLC:"Eindhoven",actionLines:"Health & Wellbeing, Smart Energy Systems",eLLType:"Lab",link:"http://www.google.de"},{id:4}]);var t=new MapApp.Views.Orte({collection:MapApp.orteCollection});$("#orteView").append(t.render().el);var n=new MapApp.Views.AddOrt({collection:MapApp.orteCollection});new MapApp.Views.Map({collection:MapApp.orteCollection})})();