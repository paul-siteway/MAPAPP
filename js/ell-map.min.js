(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?(this._wrapped=e,void 0):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(null!=e)if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;r.computed>o&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=null==n?x.identity:k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;i>n.call(r,e[u])?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=Array(t),r=0;t>r;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},x.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);r>i;)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return 0===t.length&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,0>=f?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if("[object Array]"==i){if(o=e.length,u=o==t.length)for(;o--&&(u=O(e[o],t[o],n,r)););}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)&&(o++,!(u=x.has(t,c)&&O(e[c],t[c],n,r))))break;if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),"function"!=typeof /./&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){for(var r=Array(e),i=0;e>i;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(null==e)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);(function(){var e=this,t=e.Backbone,n=Array.prototype.slice,r=Array.prototype.splice,i;typeof exports!="undefined"?i=exports:i=e.Backbone={};i.VERSION="0.9.2";var s=e._;!s&&typeof require!="undefined"&&(s=require("underscore"));var o=e.jQuery||e.Zepto||e.ender;i.setDomLibrary=function(e){o=e};i.noConflict=function(){e.Backbone=t;return this};i.emulateHTTP=!1;i.emulateJSON=!1;var u=/\s+/,a=i.Events={on:function(e,t,n){var r,i,s,o,a;if(!t)return this;e=e.split(u);r=this._callbacks||(this._callbacks={});while(i=e.shift()){a=r[i];s=a?a.tail:{};s.next=o={};s.context=n;s.callback=t;r[i]={tail:o,next:a?a.next:s}}return this},off:function(e,t,n){var r,i,o,a,f,l;if(!(i=this._callbacks))return;if(!(e||t||n)){delete this._callbacks;return this}e=e?e.split(u):s.keys(i);while(r=e.shift()){o=i[r];delete i[r];if(!o||!t&&!n)continue;a=o.tail;while((o=o.next)!==a){f=o.callback;l=o.context;(t&&f!==t||n&&l!==n)&&this.on(r,f,l)}}return this},trigger:function(e){var t,r,i,s,o,a,f;if(!(i=this._callbacks))return this;a=i.all;e=e.split(u);f=n.call(arguments,1);while(t=e.shift()){if(r=i[t]){s=r.tail;while((r=r.next)!==s)r.callback.apply(r.context||this,f)}if(r=a){s=r.tail;o=[t].concat(f);while((r=r.next)!==s)r.callback.apply(r.context||this,o)}}return this}};a.bind=a.on;a.unbind=a.off;var f=i.Model=function(e,t){var n;e||(e={});t&&t.parse&&(e=this.parse(e));if(n=C(this,"defaults"))e=s.extend({},n,e);t&&t.collection&&(this.collection=t.collection);this.attributes={};this._escapedAttributes={};this.cid=s.uniqueId("c");this.changed={};this._silent={};this._pending={};this.set(e,{silent:!0});this.changed={};this._silent={};this._pending={};this._previousAttributes=s.clone(this.attributes);this.initialize.apply(this,arguments)};s.extend(f.prototype,a,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return s.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var n=this.get(e);return this._escapedAttributes[e]=s.escape(n==null?"":""+n)},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,o;if(s.isObject(e)||e==null){r=e;n=t}else{r={};r[e]=t}n||(n={});if(!r)return this;r instanceof f&&(r=r.attributes);if(n.unset)for(i in r)r[i]=void 0;if(!this._validate(r,n))return!1;this.idAttribute in r&&(this.id=r[this.idAttribute]);var u=n.changes={},a=this.attributes,l=this._escapedAttributes,c=this._previousAttributes||{};for(i in r){o=r[i];if(!s.isEqual(a[i],o)||n.unset&&s.has(a,i)){delete l[i];(n.silent?this._silent:u)[i]=!0}n.unset?delete a[i]:a[i]=o;if(!s.isEqual(c[i],o)||s.has(a,i)!=s.has(c,i)){this.changed[i]=o;n.silent||(this._pending[i]=!0)}else{delete this.changed[i];delete this._pending[i]}}n.silent||this.change(n);return this},unset:function(e,t){(t||(t={})).unset=!0;return this.set(e,null,t)},clear:function(e){(e||(e={})).unset=!0;return this.set(s.clone(this.attributes),e)},fetch:function(e){e=e?s.clone(e):{};var t=this,n=e.success;e.success=function(r,i,s){if(!t.set(t.parse(r,s),e))return!1;n&&n(t,r)};e.error=i.wrapError(e.error,t,e);return(this.sync||i.sync).call(this,"read",this,e)},save:function(e,t,n){var r,o;if(s.isObject(e)||e==null){r=e;n=t}else{r={};r[e]=t}n=n?s.clone(n):{};if(n.wait){if(!this._validate(r,n))return!1;o=s.clone(this.attributes)}var u=s.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?u:n))return!1;var a=this,f=n.success;n.success=function(e,t,i){var o=a.parse(e,i);if(n.wait){delete n.wait;o=s.extend(r||{},o)}if(!a.set(o,n))return!1;f?f(a,e):a.trigger("sync",a,e,n)};n.error=i.wrapError(n.error,a,n);var l=this.isNew()?"create":"update",c=(this.sync||i.sync).call(this,l,this,n);n.wait&&this.set(o,u);return c},destroy:function(e){e=e?s.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(this.isNew()){r();return!1}e.success=function(i){e.wait&&r();n?n(t,i):t.trigger("sync",t,i,e)};e.error=i.wrapError(e.error,t,e);var o=(this.sync||i.sync).call(this,"delete",this,e);e.wait||r();return o},url:function(){var e=C(this,"urlRoot")||C(this.collection,"url")||k();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var n in this._silent)this._pending[n]=!0;var r=s.extend({},e.changes,this._silent);this._silent={};for(var n in r)this.trigger("change:"+n,this,this.get(n),e);if(t)return this;while(!s.isEmpty(this._pending)){this._pending={};this.trigger("change",this,e);for(var n in this.changed){if(this._pending[n]||this._silent[n])continue;delete this.changed[n]}this._previousAttributes=s.clone(this.attributes)}this._changing=!1;return this},hasChanged:function(e){return arguments.length?s.has(this.changed,e):!s.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?s.clone(this.changed):!1;var t,n=!1,r=this._previousAttributes;for(var i in e){if(s.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return s.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=s.extend({},this.attributes,e);var n=this.validate(e,t);if(!n)return!0;t&&t.error?t.error(this,n,t):this.trigger("error",this,n,t);return!1}});var l=i.Collection=function(e,t){t||(t={});t.model&&(this.model=t.model);t.comparator&&(this.comparator=t.comparator);this._reset();this.initialize.apply(this,arguments);e&&this.reset(e,{silent:!0,parse:t.parse})};s.extend(l.prototype,a,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var n,i,o,u,a,f,l={},c={},h=[];t||(t={});e=s.isArray(e)?e.slice():[e];for(n=0,o=e.length;n<o;n++){if(!(u=e[n]=this._prepareModel(e[n],t)))throw new Error("Can't add an invalid model to a collection");a=u.cid;f=u.id;if(l[a]||this._byCid[a]||f!=null&&(c[f]||this._byId[f])){h.push(n);continue}l[a]=c[f]=u}n=h.length;while(n--)e.splice(h[n],1);for(n=0,o=e.length;n<o;n++){(u=e[n]).on("all",this._onModelEvent,this);this._byCid[u.cid]=u;u.id!=null&&(this._byId[u.id]=u)}this.length+=o;i=t.at!=null?t.at:this.models.length;r.apply(this.models,[i,0].concat(e));this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(n=0,o=this.models.length;n<o;n++){if(!l[(u=this.models[n]).cid])continue;t.index=n;u.trigger("add",u,this,t)}return this},remove:function(e,t){var n,r,i,o;t||(t={});e=s.isArray(e)?e.slice():[e];for(n=0,r=e.length;n<r;n++){o=this.getByCid(e[n])||this.get(e[n]);if(!o)continue;delete this._byId[o.id];delete this._byCid[o.cid];i=this.indexOf(o);this.models.splice(i,1);this.length--;if(!t.silent){t.index=i;o.trigger("remove",o,this,t)}this._removeReference(o)}return this},push:function(e,t){e=this._prepareModel(e,t);this.add(e,t);return e},pop:function(e){var t=this.at(this.length-1);this.remove(t,e);return t},unshift:function(e,t){e=this._prepareModel(e,t);this.add(e,s.extend({at:0},t));return e},shift:function(e){var t=this.at(0);this.remove(t,e);return t},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return s.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=s.bind(this.comparator,this);this.comparator.length==1?this.models=this.sortBy(t):this.models.sort(t);e.silent||this.trigger("reset",this,e);return this},pluck:function(e){return s.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]);t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);this._reset();this.add(e,s.extend({silent:!0},t));t.silent||this.trigger("reset",this,t);return this},fetch:function(e){e=e?s.clone(e):{};e.parse===undefined&&(e.parse=!0);var t=this,n=e.success;e.success=function(r,i,s){t[e.add?"add":"reset"](t.parse(r,s),e);n&&n(t,r)};e.error=i.wrapError(e.error,t,e);return(this.sync||i.sync).call(this,"read",this,e)},create:function(e,t){var n=this;t=t?s.clone(t):{};e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;t.success=function(i,s,o){t.wait&&n.add(i,t);r?r(i,s):i.trigger("sync",e,s,t)};e.save(null,t);return e},parse:function(e,t){return e},chain:function(){return s(this.models).chain()},_reset:function(e){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(e,t){t||(t={});if(e instanceof f)e.collection||(e.collection=this);else{var n=e;t.collection=this;e=new this.model(n,t);e._validate(e.attributes,t)||(e=!1)}return e},_removeReference:function(e){this==e.collection&&delete e.collection;e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this.remove(t,r);if(t&&e==="change:"+t.idAttribute){delete this._byId[t.previous(t.idAttribute)];this._byId[t.id]=t}this.trigger.apply(this,arguments)}});var c=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];s.each(c,function(e){l.prototype[e]=function(){return s[e].apply(s,[this.models].concat(s.toArray(arguments)))}});var h=i.Router=function(e){e||(e={});e.routes&&(this.routes=e.routes);this._bindRoutes();this.initialize.apply(this,arguments)},p=/:\w+/g,d=/\*\w+/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;s.extend(h.prototype,a,{initialize:function(){},route:function(e,t,n){i.history||(i.history=new m);s.isRegExp(e)||(e=this._routeToRegExp(e));n||(n=this[t]);i.history.route(e,s.bind(function(r){var s=this._extractParameters(e,r);n&&n.apply(this,s);this.trigger.apply(this,["route:"+t].concat(s));i.history.trigger("route",this,t,s)},this));return this},navigate:function(e,t){i.history.navigate(e,t)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){e=e.replace(v,"\\$&").replace(p,"([^/]+)").replace(d,"(.*?)");return new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var m=i.History=function(){this.handlers=[];s.bindAll(this,"checkUrl")},g=/^[#\/]/,y=/msie [\w.]+/;m.started=!1;s.extend(m.prototype,a,{interval:50,getHash:function(e){var t=e?e.location:window.location,n=t.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n)}else e=this.getHash();e.indexOf(this.options.root)||(e=e.substr(this.options.root.length));return e.replace(g,"")},start:function(e){if(m.started)throw new Error("Backbone.history has already been started");m.started=!0;this.options=s.extend({},{root:"/"},this.options,e);this._wantsHashChange=this.options.hashChange!==!1;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),n=document.documentMode,r=y.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);if(r){this.iframe=o('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(t)}this._hasPushState?o(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=t;var i=window.location,u=i.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u){this.fragment=this.getFragment(null,!0);window.location.replace(this.options.root+"#"+this.fragment);return!0}if(this._wantsPushState&&this._hasPushState&&u&&i.hash){this.fragment=this.getHash().replace(g,"");window.history.replaceState({},document.title,i.protocol+"//"+i.host+this.options.root+this.fragment)}if(!this.options.silent)return this.loadUrl()},stop:function(){o(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);m.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t==this.fragment)return!1;this.iframe&&this.navigate(t);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=s.any(this.handlers,function(e){if(e.route.test(t)){e.callback(t);return!0}});return n},navigate:function(e,t){if(!m.started)return!1;if(!t||t===!0)t={trigger:t};var n=(e||"").replace(g,"");if(this.fragment==n)return;if(this._hasPushState){n.indexOf(this.options.root)!=0&&(n=this.options.root+n);this.fragment=n;window.history[t.replace?"replaceState":"pushState"]({},document.title,n)}else if(this._wantsHashChange){this.fragment=n;this._updateHash(window.location,n,t.replace);if(this.iframe&&n!=this.getFragment(this.getHash(this.iframe))){t.replace||this.iframe.document.open().close();this._updateHash(this.iframe.location,n,t.replace)}}else window.location.assign(this.options.root+e);t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){n?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var b=i.View=function(e){this.cid=s.uniqueId("view");this._configure(e||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},w=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName"];s.extend(b.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(e,t,n){var r=document.createElement(e);t&&o(r).attr(t);n&&o(r).html(n);return r},setElement:function(e,t){this.$el&&this.undelegateEvents();this.$el=e instanceof o?e:o(e);this.el=this.$el[0];t!==!1&&this.delegateEvents();return this},delegateEvents:function(e){if(!e&&!(e=C(this,"events")))return;this.undelegateEvents();for(var t in e){var n=e[t];s.isFunction(n)||(n=this[e[t]]);if(!n)throw new Error('Method "'+e[t]+'" does not exist');var r=t.match(w),i=r[1],o=r[2];n=s.bind(n,this);i+=".delegateEvents"+this.cid;o===""?this.$el.bind(i,n):this.$el.delegate(o,i,n)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=s.extend({},this.options,e));for(var t=0,n=E.length;t<n;t++){var r=E[t];e[r]&&(this[r]=e[r])}this.options=e},_ensureElement:function(){if(!this.el){var e=C(this,"attributes")||{};this.id&&(e.id=this.id);this.className&&(e["class"]=this.className);this.setElement(this.make(this.tagName,e),!1)}else this.setElement(this.el,!1)}});var S=function(e,t){var n=N(this,e,t);n.extend=this.extend;return n};f.extend=l.extend=h.extend=b.extend=S;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};i.sync=function(e,t,n){var r=x[e];n||(n={});var u={type:r,dataType:"json"};n.url||(u.url=C(t,"url")||k());if(!n.data&&t&&(e=="create"||e=="update")){u.contentType="application/json";u.data=JSON.stringify(t.toJSON())}if(i.emulateJSON){u.contentType="application/x-www-form-urlencoded";u.data=u.data?{model:u.data}:{}}if(i.emulateHTTP)if(r==="PUT"||r==="DELETE"){i.emulateJSON&&(u.data._method=r);u.type="POST";u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r)}}u.type!=="GET"&&!i.emulateJSON&&(u.processData=!1);return o.ajax(s.extend(u,n))};i.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r;e?e(t,i,n):t.trigger("error",t,i,n)}};var T=function(){},N=function(e,t,n){var r;t&&t.hasOwnProperty("constructor")?r=t.constructor:r=function(){e.apply(this,arguments)};s.extend(r,e);T.prototype=e.prototype;r.prototype=new T;t&&s.extend(r.prototype,t);n&&s.extend(r,n);r.prototype.constructor=r;r.__super__=e.prototype;return r},C=function(e,t){return!e||!e[t]?null:s.isFunction(e[t])?e[t]():e[t]},k=function(){throw new Error('A "url" property or function must be specified')}}).call(this);(function(){var e,t,n,r,i,s,o=[].slice;n=function(e){var t,r;return!_.isObject(e)||_.isFunction(e)?e:e instanceof Backbone.Collection||e instanceof Backbone.Model?e:_.isDate(e)?new Date(e.getTime()):_.isRegExp(e)?new RegExp(e.source,e.toString().replace(/.*\//,"")):(r=_.isArray(e||_.isArguments(e)),t=function(e,t,i){return r?e.push(n(t)):e[i]=n(t),e},_.reduce(e,t,r?[]:{}))},s=function(e){return e==null?!1:(e.prototype==={}.prototype||e.prototype===Object.prototype)&&_.isObject(e)&&!_.isArray(e)&&!_.isFunction(e)&&!_.isDate(e)&&!_.isRegExp(e)&&!_.isArguments(e)},t=function(e){return _.filter(_.keys(e),function(t){return s(e[t])})},e=function(e){return _.filter(_.keys(e),function(t){return _.isArray(e[t])})},i=function(n,r,s){var o,u,a,f,l,c,h,p,d,v;s==null&&(s=20);if(s<=0)return console.warn("_.deepExtend(): Maximum depth of recursion hit."),_.extend(n,r);c=_.intersection(t(n),t(r)),u=function(e){return r[e]=i(n[e],r[e],s-1)};for(h=0,d=c.length;h<d;h++)l=c[h],u(l);f=_.intersection(e(n),e(r)),o=function(e){return r[e]=_.union(n[e],r[e])};for(p=0,v=f.length;p<v;p++)a=f[p],o(a);return _.extend(n,r)},r=function(){var e,t,r,s;r=2<=arguments.length?o.call(arguments,0,s=arguments.length-1):(s=0,[]),t=arguments[s++],_.isNumber(t)||(r.push(t),t=20);if(r.length<=1)return r[0];if(t<=0)return _.extend.apply(this,r);e=r.shift();while(r.length>0)e=i(e,n(r.shift()),t);return e},_.mixin({deepClone:n,isBasicObject:s,basicObjects:t,arrays:e,deepExtend:r})}).call(this),function(e){typeof define=="function"&&define.amd?define(["underscore","backbone"],e):e(_,Backbone)}(function(e,t){function n(t){var r={},i=o.keyPathSeparator;for(var s in t){var u=t[s];if(u&&u.constructor===Object&&!e.isEmpty(u)){var a=n(u);for(var f in a){var l=a[f];r[s+i+f]=l}}else r[s]=u}return r}function r(t,n,r){var i=o.keyPathSeparator,s=n.split(i),u=t;r||r===!1;for(var a=0,f=s.length;a<f;a++){if(r&&!e.has(u,s[a]))return!1;u=u[s[a]],u==null&&a<f-1&&(u={});if(typeof u=="undefined")return r?!0:u}return r?!0:u}function i(t,n,r,i){i=i||{};var s=o.keyPathSeparator,u=n.split(s),a=t;for(var f=0,l=u.length;f<l&&a!==undefined;f++){var c=u[f];if(f===l-1)i.unset?delete a[c]:a[c]=r;else{if(typeof a[c]=="undefined"||!e.isObject(a[c]))a[c]={};a=a[c]}}}function s(e,t){i(e,t,null,{unset:!0})}var o=t.Model.extend({constructor:function(t,n){var r,i=t||{};this.cid=e.uniqueId("c"),this.attributes={},n&&n.collection&&(this.collection=n.collection),n&&n.parse&&(i=this.parse(i,n)||{});if(r=e.result(this,"defaults"))i=e.deepExtend({},r,i);this.set(i,n),this.changed={},this.initialize.apply(this,arguments)},toJSON:function(t){return e.deepClone(this.attributes)},get:function(e){return r(this.attributes,e)},set:function(t,u,a){var f,l,c,h,p,d,v,m;if(t==null)return this;typeof 
t=="object"?(l=t,a=u||{}):(l={})[t]=u,a||(a={});if(!this._validate(l,a))return!1;c=a.unset,p=a.silent,h=[],d=this._changing,this._changing=!0,d||(this._previousAttributes=e.deepClone(this.attributes),this.changed={}),m=this.attributes,v=this._previousAttributes,this.idAttribute in l&&(this.id=l[this.idAttribute]),l=n(l);for(f in l)u=l[f],e.isEqual(r(m,f),u)||h.push(f),e.isEqual(r(v,f),u)?s(this.changed,f):i(this.changed,f,u),c?s(m,f):i(m,f,u);if(!p){h.length&&(this._pending=!0);var g=o.keyPathSeparator;for(var y=0,b=h.length;y<b;y++){var t=h[y];this.trigger("change:"+t,this,r(m,t),a);var w=t.split(g);for(var E=w.length-1;E>0;E--){var S=e.first(w,E).join(g),x=S+g+"*";this.trigger("change:"+x,this,r(m,S),a)}}}if(d)return this;if(!p)while(this._pending)this._pending=!1,this.trigger("change",this,a);return this._pending=!1,this._changing=!1,this},clear:function(t){var r={},i=n(this.attributes);for(var s in i)r[s]=void 0;return this.set(r,e.extend({},t,{unset:!0}))},hasChanged:function(t){return t==null?!e.isEmpty(this.changed):r(this.changed,t)!==undefined},changedAttributes:function(t){if(!t)return this.hasChanged()?n(this.changed):!1;var r=this._changing?this._previousAttributes:this.attributes;t=n(t),r=n(r);var i,s=!1;for(var o in t){if(e.isEqual(r[o],i=t[o]))continue;(s||(s={}))[o]=i}return s},previous:function(e){return e==null||!this._previousAttributes?null:r(this._previousAttributes,e)},previousAttributes:function(){return e.deepClone(this._previousAttributes)}});return o.keyPathSeparator=".",t.DeepModel=o,typeof module!="undefined"&&(module.exports=o),t});var __slice=[].slice,__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};(function(e){return e("backbone-query",function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;return w=e("underscore"),n=e("backbone"),i=function(e,t){var n,r,i,s;s=[];for(r=0,i=e.length;r<i;r++)n=e[r],t(n)&&s.push(n);return s},v=function(e,t){var n,r,i,s;s=[];for(r=0,i=e.length;r<i;r++)n=e[r],t(n)||s.push(n);return s},r=function(e,t){var n,r,i;for(r=0,i=e.length;r<i;r++){n=e[r];if(t(n))return!0}return!1},f=function(){var e,t,n,r,i;e=1<=arguments.length?__slice.call(arguments,0):[],r={},t=r;while(e.length)n=e.shift(),i=e.length===1?e.shift():{},t=t[n]=i;return r},u=function(e){return w.isRegExp(e)?"$regex":w.isDate(e)?"$date":w.isObject(e)&&!w.isArray(e)?"object":w.isArray(e)?"array":w.isString(e)?"string":w.isNumber(e)?"number":w.isBoolean(e)?"boolean":w.isFunction(e)?"function":!1},h=function(e){var t,n,r,i,s,o,a,l,p,d,v,m,g;w.isArray(e)?o=e:o=function(){var n;n=[];for(t in e){if(!__hasProp.call(e,t))continue;p=e[t],n.push(f(t,p))}return n}(),g=[];for(v=0,m=o.length;v<m;v++){s=o[v];for(t in s){if(!__hasProp.call(s,t))continue;a=s[t],n={key:t},r=u(a);switch(r){case"$regex":case"$date":n.type=r,n.value=a;break;case"object":if(t==="$and"||t==="$or"||t==="$nor"||t==="$not")n.value=h(a),n.type=t,n.key=null;else for(l in a){d=a[l];if(b(l,d)){n.type=l;switch(l){case"$elemMatch":case"$relationMatch":n.value=c(d);break;case"$computed":i=f(t,d),n.value=h(i);break;default:n.value=d}}}break;default:n.type="$equal",n.value=a}n.type==="$equal"&&(r==="object"||r==="array")&&(n.type="$oEqual")}g.push(n)}return g},b=function(e,t){switch(e){case"$in":case"$nin":case"$all":case"$any":return w(t).isArray();case"$size":return w(t).isNumber();case"$regex":return w(t).isRegExp();case"$like":case"$likeI":return w(t).isString();case"$between":return w(t).isArray()&&t.length===2;case"$cb":return w(t).isFunction();default:return!0}},y=function(e,t){switch(e){case"$like":case"$likeI":case"$regex":return w(t).isString();case"$contains":case"$all":case"$any":case"$elemMatch":return w(t).isArray();case"$size":return w(t).isArray()||w(t).isString();case"$in":case"$nin":return t!=null;case"$relationMatch":return t!=null&&t.models;default:return!0}},p=function(e,t,n,i,s){switch(e){case"$equal":return w(n).isArray()?__indexOf.call(n,t)>=0:n===t;case"$oEqual":return w(n).isEqual(t);case"$contains":return __indexOf.call(n,t)>=0;case"$ne":return n!==t;case"$lt":return n<t;case"$gt":return n>t;case"$lte":return n<=t;case"$gte":return n>=t;case"$between":return t[0]<n&&n<t[1];case"$in":return __indexOf.call(t,n)>=0;case"$nin":return __indexOf.call(t,n)<0;case"$all":return w(t).all(function(e){return __indexOf.call(n,e)>=0});case"$any":return w(n).any(function(e){return __indexOf.call(t,e)>=0});case"$size":return n.length===t;case"$exists":case"$has":return n!=null===t;case"$like":return n.indexOf(t)!==-1;case"$likeI":return n.toLowerCase().indexOf(t.toLowerCase())!==-1;case"$regex":return t.test(n);case"$cb":return t.call(i,n);case"$elemMatch":return m(n,t,"elemMatch").length>0;case"$relationMatch":return m(n.models,t,"relationMatch").length>0;case"$computed":return a([i],t,!1,r,"computed");case"$and":case"$or":case"$nor":case"$not":return d[e]([i],t).length===1;default:return!1}},a=function(e,t,n,r,i){return i==null&&(i=!1),r(e,function(e){var r,s,o,u,a;for(u=0,a=t.length;u<a;u++){s=t[u],r=function(){switch(i){case"elemMatch":return e[s.key];case"computed":return e[s.key]();default:return e.get(s.key)}}(),o=y(s.type,r),o&&(o=p(s.type,s.value,r,e,s.key));if(n===o)return n}return!n})},d={$and:function(e,t,n){return a(e,t,!1,i,n)},$or:function(e,t,n){return a(e,t,!0,i,n)},$nor:function(e,t,n){return a(e,t,!0,v,n)},$not:function(e,t,n){return a(e,t,!1,v,n)}},c=function(e){var t,n,r,i,s,o;i=w(e).keys(),t=["$and","$not","$or","$nor"],n=w.intersection(t,i);if(n.length===0)return[{type:"$and",parsedQuery:h(e)}];if(n.length!==i.length){__indexOf.call(n,"$and")<0&&(e.$and={},n.unshift("$and"));for(r in e){if(!__hasProp.call(e,r))continue;o=e[r];if(!(__indexOf.call(t,r)<0))continue;e.$and[r]=o,delete e[r]}}return function(){var t,r,i;i=[];for(t=0,r=n.length;t<r;t++)s=n[t],i.push({type:s,parsedQuery:h(e[s])});return i}()},m=function(e,t,n){var r;return n||(t=c(t)),r=function(e,t){return d[t.type](e,t.parsedQuery,n)},w.reduce(t,r,e)},s=function(e,t,n){var r,i,s,u;return s=JSON.stringify(t),r=(u=e._queryCache)!=null?u:e._queryCache={},i=r[s],i||(i=o(e,t,n),r[s]=i),i},o=function(e,t,n){var r;return r=m(e.models,t),n.sortBy&&(r=g(r,n)),r},g=function(e,t){return w(t.sortBy).isString()?e=w(e).sortBy(function(e){return e.get(t.sortBy)}):w(t.sortBy).isFunction()&&(e=w(e).sortBy(t.sortBy)),t.order==="desc"&&(e=e.reverse()),e},l=function(e,t){var n,r,i,s;return t.offset?i=t.offset:t.page?i=(t.page-1)*t.limit:i=0,n=i+t.limit,r=e.slice(i,n),t.pager&&w.isFunction(t.pager)&&(s=Math.ceil(e.length/t.limit),t.pager(s,r)),r},n.QueryCollection=n.Collection.extend({query:function(e,t){var n;return t==null&&(t={}),t.cache?n=s(this,e,t):n=o(this,e,t),t.limit&&(n=l(n,t)),n},findOne:function(e){return this.query(e)[0]},whereBy:function(e,t){return t==null&&(t={}),new this.constructor(this.query(e,t))},resetQueryCache:function(){return this._queryCache={}}}),t.QueryCollection=n.QueryCollection})}).call(this,typeof define=="function"&&define.amd?define:function(e,t){typeof exports!="undefined"?t(function(e){return require(e)},exports):t(function(e){return this[e==="underscore"?"_":"Backbone"]},{})});!function(e){"use strict";e(function(){e.support.transition=function(){var e=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},n;for(n in t)if(e.style[n]!==undefined)return t[n]}();return e&&{end:e}}()})}(window.jQuery);!function(e){"use strict";function r(){e(t).each(function(){i(e(this)).removeClass("open")})}function i(t){var n=t.attr("data-target"),r;if(!n){n=t.attr("href");n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,"")}r=n&&e(n);if(!r||!r.length)r=t.parent();return r}var t="[data-toggle=dropdown]",n=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};n.prototype={constructor:n,toggle:function(t){var n=e(this),s,o;if(n.is(".disabled, :disabled"))return;s=i(n);o=s.hasClass("open");r();o||s.toggleClass("open");n.focus();return!1},keydown:function(n){var r,s,o,u,a,f;if(!/(38|40|27)/.test(n.keyCode))return;r=e(this);n.preventDefault();n.stopPropagation();if(r.is(".disabled, :disabled"))return;u=i(r);a=u.hasClass("open");if(!a||a&&n.keyCode==27){n.which==27&&u.find(t).focus();return r.click()}s=e("[role=menu] li:not(.divider):visible a",u);if(!s.length)return;f=s.index(s.filter(":focus"));n.keyCode==38&&f>0&&f--;n.keyCode==40&&f<s.length-1&&f++;~f||(f=0);s.eq(f).focus()}};var s=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var r=e(this),i=r.data("dropdown");i||r.data("dropdown",i=new n(this));typeof t=="string"&&i[t].call(r)})};e.fn.dropdown.Constructor=n;e.fn.dropdown.noConflict=function(){e.fn.dropdown=s;return this};e(document).on("click.dropdown.data-api",r).on("click.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown-menu",function(e){e.stopPropagation()}).on("click.dropdown.data-api",t,n.prototype.toggle).on("keydown.dropdown.data-api",t+", [role=menu]",n.prototype.keydown)}(window.jQuery);!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s,o;if(!r){r=t.attr("href");r=r&&r.replace(/.*(?=#[^\s]*$)/,"")}if(t.parent("li").hasClass("active"))return;i=n.find(".active:last a")[0];o=e.Event("show",{relatedTarget:i});t.trigger(o);if(o.isDefaultPrevented())return;s=e(r);this.activate(t.parent("li"),n);this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");t.addClass("active");if(s){t[0].offsetWidth;t.addClass("in")}else t.removeClass("fade");t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active");r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o):o();i.removeClass("in")}};var n=e.fn.tab;e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this));typeof n=="string"&&i[n]()})};e.fn.tab.Constructor=t;e.fn.tab.noConflict=function(){e.fn.tab=n;return this};e(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault();e(this).tab("show")})}(window.jQuery);!function(e){"use strict";function t(t,n){this.options=this.getOptions(n);this.$select=e(t);this.$select.attr("multiple")||this.$select.attr("multiple",!0);this.$container=e(this.options.buttonContainer).append('<button type="button" class="multiselect dropdown-toggle '+this.options.buttonClass+'" data-toggle="dropdown">'+this.options.buttonText(e("option:selected",t),this.$select)+"</button>").append('<ul class="dropdown-menu"></ul>');this.options.buttonWidth&&e("button",this.$container).css({width:this.options.buttonWidth});this.options.maxHeight&&e("ul",this.$container).css({"max-height":this.options.maxHeight+"px","overflow-y":"auto","overflow-x":"hidden"});this.buildDrowdown();this.$select.hide().after(this.$container)}typeof ko!="undefined"&&ko.bindingHandlers&&!ko.bindingHandlers.multiselect&&(ko.bindingHandlers.multiselect={init:function(t){var n=e(t).data("multiselect");if(!n)throw new Error("Bootstrap-multiselect's multiselect() has to be called on element before applying the Knockout View model!");var r=n.options.onChange;n.options.onChange=function(n,i){e(t).data("blockRefresh",!0);e(t).trigger("change");return r(n,i)}},update:function(t){var n=e(t).data("blockRefresh")||!1;n||e(t).multiselect("rebuild");e.data(t,"blockRefresh",!1)}});t.prototype={defaults:{buttonText:function(t,n){if(t.length==0)return'None selected <b class="caret"></b>';if(t.length>3)return t.length+' selected <b class="caret"></b>';var r="";t.each(function(){r+=e(this).text()+", "});return r.substr(0,r.length-2)+' <b class="caret"></b>'},onChange:function(e,t){},buttonClass:"btn",buttonWidth:"auto",buttonContainer:'<div class="btn-group" />',maxHeight:!1},constructor:t,createOptionValue:function(t){if(e(t).is(":selected")){e(t).attr("selected","selected");e(t).prop("selected","selected")}e("ul",this.$container).append('<li><a href="javascript:void(0);" style="padding:0;"><label style="margin:0;padding:3px 20px 3px 20px;width:100%;height:100%;cursor:pointer;"><input style="margin-bottom:5px;" type="checkbox" value="'+e(t).val()+'" /> '+e(t).text()+"</label></a></li>");var n=e(t).prop("selected")||!1,r=e('ul li input[value="'+e(t).val()+'"]',this.$container);e(t).is(":disabled")&&r.attr("disabled","disabled").prop("disabled","disabled").parents("li").addClass("disabled");r.prop("checked",n);n&&r.parents("li").addClass("active")},buildDrowdown:function(){e("optgroup",this.$select).length>0?e("optgroup",this.$select).each(e.proxy(function(t,n){var r=e(n).prop("label");e("ul",this.$container).append('<li><label style="margin:0;padding:3px 20px 3px 20px;width:100%;height:100%;" class="multiselect-group"> '+r+"</label></li>");e("option",n).each(e.proxy(function(e,t){this.createOptionValue(t)},this))},this)):e("option",this.$select).each(e.proxy(function(e,t){this.createOptionValue(t)},this));e('ul li input[type="checkbox"]',this.$container).on("change",e.proxy(function(t){var n=e(t.target).prop("checked")||!1;n?e(t.target).parents("li").addClass("active"):e(t.target).parents("li").removeClass("active");var r=e('option[value="'+e(t.target).val()+'"]',this.$select);if(n){r.attr("selected","selected");r.prop("selected","selected")}else r.removeAttr("selected");var i=e("option:selected",this.$select);e("button",this.$container).html(this.options.buttonText(i,this.$select));this.options.onChange(r,n)},this));e("ul li a",this.$container).on("click",function(e){e.stopPropagation()})},destroy:function(){this.$container.remove();this.$select.show()},refresh:function(){e("option",this.$select).each(e.proxy(function(t,n){if(e(n).is(":selected")){e('ul li input[value="'+e(n).val()+'"]',this.$container).prop("checked",!0);e('ul li input[value="'+e(n).val()+'"]',this.$container).parents("li").addClass("active")}else{e('ul li input[value="'+e(n).val()+'"]',this.$container).prop("checked",!1);e('ul li input[value="'+e(n).val()+'"]',this.$container).parents("li").removeClass("active")}},this));e("button",this.$container).html(this.options.buttonText(e("option:selected",this.$select),this.$select))},select:function(t){var n=e('option[value="'+t+'"]',this.$select),r=e('ul li input[value="'+t+'"]',this.$container);r.parents("li").addClass("active");r.prop("checked",!0);n.attr("selected","selected");n.prop("selected","selected");var i=e("option:selected",this.$select);e("button",this.$container).html(this.options.buttonText(i,this.$select))},deselect:function(t){var n=e('option[value="'+t+'"]',this.$select),r=e('ul li input[value="'+t+'"]',this.$container);r.parents("li").removeClass("active");r.prop("checked",!1);n.removeAttr("selected");n.removeProp("selected");var i=e("option:selected",this.$select);e("button",this.$container).html(this.options.buttonText(i,this.$select))},rebuild:function(){e("ul",this.$container).html("");this.buildDrowdown(this.$select,this.options)},getOptions:function(t){return e.extend({},this.defaults,t)}};e.fn.multiselect=function(n,r){return this.each(function(){var i=e(this).data("multiselect"),s=typeof n=="object"&&n;i||e(this).data("multiselect",i=new t(this,s));typeof n=="string"&&i[n](r)})}}(window.jQuery);if(!window.google||!window.google.maps)throw"Google Maps API is required. Please register the following JavaScript library http://maps.google.com/maps/api/js?sensor=true.";var GMaps=function(e){"use strict";var t=document,n=function(n,r){var i;"jQuery"in e&&r?i=$("#"+n.replace("#",""),r)[0]:i=t.getElementById(n.replace("#",""));return i},r=function(e){var i=this,s=["bounds_changed","center_changed","click","dblclick","drag","dragend","dragstart","idle","maptypeid_changed","projection_changed","resize","tilesloaded","zoom_changed"],o=["mousemove","mouseout","mouseover"];window.context_menu={};typeof e.el=="string"||typeof e.div=="string"?this.el=n(e.el||e.div,e.context):this.el=e.el||e.div;if(typeof this.el=="undefined"||this.el===null)throw"No element defined.";this.el.style.width=e.width||this.el.scrollWidth||this.el.offsetWidth;this.el.style.height=e.height||this.el.scrollHeight||this.el.offsetHeight;this.controls=[];this.overlays=[];this.layers=[];this.singleLayers={};this.markers=[];this.polylines=[];this.routes=[];this.polygons=[];this.infoWindow=null;this.overlay_el=null;this.zoom=e.zoom||15;this.registered_events={};var u=e.markerClusterer,a;e.mapType?a=google.maps.MapTypeId[e.mapType.toUpperCase()]:a=google.maps.MapTypeId.ROADMAP;var f=new google.maps.LatLng(e.lat,e.lng);delete e.el;delete e.lat;delete e.lng;delete e.mapType;delete e.width;delete e.height;delete e.markerClusterer;var l=e.zoomControlOpt||{style:"DEFAULT",position:"TOP_LEFT"},c=e.zoomControl||!0,h=l.style||"DEFAULT",p=l.position||"TOP_LEFT",d=e.panControl||!0,v=e.mapTypeControl||!0,m=e.scaleControl||!0,g=e.streetViewControl||!0,y=y||!0,b={},w={zoom:this.zoom,center:f,mapTypeId:a},E={panControl:d,zoomControl:c,zoomControlOptions:{style:google.maps.ZoomControlStyle[h],position:google.maps.ControlPosition[p]},mapTypeControl:v,scaleControl:m,streetViewControl:g,overviewMapControl:y};e.disableDefaultUI!=1&&(w=extend_object(w,E));b=extend_object(w,e);for(var S=0;S<s.length;S++)delete b[s[S]];for(var S=0;S<o.length;S++)delete b[o[S]];this.map=new google.maps.Map(this.el,b);u&&(this.markerClusterer=u.apply(this,[this.map]));var x=function(e){var t=0,n=0;if(e.offsetParent)do{t+=e.offsetLeft;n+=e.offsetTop}while(e=e.offsetParent);return[t,n]},T=function(e,t){var r="",s=window.context_menu[e];for(var o in s)if(s.hasOwnProperty(o)){var u=s[o];r+='<li><a id="'+e+"_"+o+'" href="#">'+u.title+"</a></li>"}if(!n("gmaps_context_menu"))return;var a=n("gmaps_context_menu");a.innerHTML=r;var f=a.getElementsByTagName("a"),l=f.length;for(var o=0;o<l;o++){var c=f[o],h=function(n){n.preventDefault();s[this.id.replace(e+"_","")].action.apply(i,[t]);i.hideContextMenu()};google.maps.event.clearListeners(c,"click");google.maps.event.addDomListenerOnce(c,"click",h,!1)}var p=x.apply(this,[i.el]),d=p[0]+t.pixel.x-15,v=p[1]+t.pixel.y-15;a.style.left=d+"px";a.style.top=v+"px";a.style.display="block"},N=function(e,t){if(e==="marker"){t.pixel={};var n=new google.maps.OverlayView;n.setMap(i.map);n.draw=function(){var r=n.getProjection(),i=t.marker.getPosition();t.pixel=r.fromLatLngToContainerPixel(i);T(e,t)}}else T(e,t)};this.setContextMenu=function(e){window.context_menu[e.control]={};for(var r in e.options)if(e.options.hasOwnProperty(r)){var i=e.options[r];window.context_menu[e.control][i.name]={title:i.title,action:i.action}}var s=t.createElement("ul");s.id="gmaps_context_menu";s.style.display="none";s.style.position="absolute";s.style.minWidth="100px";s.style.background="white";s.style.listStyle="none";s.style.padding="8px";s.style.boxShadow="2px 2px 6px #ccc";t.body.appendChild(s);var o=n("gmaps_context_menu");google.maps.event.addDomListener(o,"mouseout",function(e){(!e.relatedTarget||!this.contains(e.relatedTarget))&&window.setTimeout(function(){o.style.display="none"},400)},!1)};this.hideContextMenu=function(){var e=n("gmaps_context_menu");e&&(e.style.display="none")};var C=function(t,n){google.maps.event.addListener(t,n,function(t){t==undefined&&(t=this);e[n].apply(this,[t]);i.hideContextMenu()})};for(var k=0;k<s.length;k++){var L=s[k];L in e&&C(this.map,L)}for(var k=0;k<o.length;k++){var L=o[k];L in e&&C(this.map,L)}google.maps.event.addListener(this.map,"rightclick",function(t){e.rightclick&&e.rightclick.apply(this,[t]);window.context_menu["map"]!=undefined&&N("map",t)});this.refresh=function(){google.maps.event.trigger(this.map,"resize")};this.fitZoom=function(){var e=[],t=this.markers.length;for(var n=0;n<t;n++)e.push(this.markers[n].getPosition());this.fitLatLngBounds(e)};this.fitLatLngBounds=function(e){var t=e.length,n=new google.maps.LatLngBounds;for(var r=0;r<t;r++)n.extend(e[r]);this.map.fitBounds(n)};this.setCenter=function(e,t,n){this.map.panTo(new google.maps.LatLng(e,t));n&&n()};this.getElement=function(){return this.el};this.zoomIn=function(e){this.zoom=this.map.getZoom()+e;this.map.setZoom(this.zoom)};this.zoomOut=function(e){this.zoom=this.map.getZoom()-e;this.map.setZoom(this.zoom)};var A=[];for(var O in this.map)typeof this.map[O]=="function"&&!this[O]&&A.push(O);for(var S=0;S<A.length;S++)(function(e,t,n){e[n]=function(){return t[n].apply(t,arguments)}})(this,this.map,A[S]);this.createControl=function(e){var n=t.createElement("div");n.style.cursor="pointer";n.style.fontFamily="Arial, sans-serif";n.style.fontSize="13px";n.style.boxShadow="rgba(0, 0, 0, 0.398438) 0px 2px 4px";for(var r in e.style)n.style[r]=e.style[r];e.id&&(n.id=e.id);e.classes&&(n.className=e.classes);e.content&&(n.innerHTML=e.content);for(var i in e.events)(function(t,n){google.maps.event.addDomListener(t,n,function(){e.events[n].apply(this,[this])})})(n,i);n.index=1;return n};this.addControl=function(e){var t=google.maps.ControlPosition[e.position.toUpperCase()];delete e.position;var n=this.createControl(e);this.controls.push(n);this.map.controls[t].push(n);return n};this.createMarker=function(e){if(e.hasOwnProperty("lat")&&e.hasOwnProperty("lng")||e.position){var t=this,n=e.details,r=e.fences,i=e.outside,s={position:new google.maps.LatLng(e.lat,e.lng),map:null};delete e.lat;delete e.lng;delete e.fences;delete e.outside;var o=extend_object(s,e),u=new google.maps.Marker(o);u.fences=r;if(e.infoWindow){u.infoWindow=new google.maps.InfoWindow(e.infoWindow);var a=["closeclick","content_changed","domready","position_changed","zindex_changed"];for(var f=0;f<a.length;f++)(function(t,n){google.maps.event.addListener(t,n,function(t){e.infoWindow[n]&&e.infoWindow[n].apply(this,[t])})})(u.infoWindow,a[f])}var l=["animation_changed","clickable_changed","cursor_changed","draggable_changed","flat_changed","icon_changed","position_changed","shadow_changed","shape_changed","title_changed","visible_changed","zindex_changed"],c=["dblclick","drag","dragend","dragstart","mousedown","mouseout","mouseover","mouseup"];for(var f=0;f<l.length;f++)(function(t,n){google.maps.event.addListener(t,n,function(){e[n]&&e[n].apply(this,[this])})})(u,l[f]);for(var f=0;f<c.length;f++)(function(t,n,r){google.maps.event.addListener(n,r,function(n){n.pixel||(n.pixel=t.getProjection().fromLatLngToPoint(n.latLng));e[r]&&e[r].apply(this,[n])})})(this.map,u,c[f]);google.maps.event.addListener(u,"click",function(){this.details=n;e.click&&e.click.apply(this,[this]);if(u.infoWindow){t.hideInfoWindows();u.infoWindow.open(t.map,u)}});google.maps.event.addListener(u,"rightclick",function(t){t.marker=this;e.rightclick&&e.rightclick.apply(this,[t]);window.context_menu["marker"]!=undefined&&N("marker",t)});(e.dragend||u.fences)&&google.maps.event.addListener(u,"dragend",function(){u.fences&&t.checkMarkerGeofence(u,function(e,t){i(e,t)})});return u}throw"No latitude or longitude defined."};this.addMarker=function(e){var t;if(e.hasOwnProperty("gm_accessors_"))t=e;else{if(!(e.hasOwnProperty("lat")&&e.hasOwnProperty("lng")||e.position))throw"No latitude or longitude defined.";t=this.createMarker(e)}t.setMap(this.map);this.markerClusterer&&this.markerClusterer.addMarker(t);this.markers.push(t);r.fire("marker_added",t,this);return t};this.addMarkers=function(e){for(var t=0,n;n=e[t];t++)this.addMarker(n);return this.markers};this.hideInfoWindows=function(){for(var e=0,t;t=this.markers[e];e++)t.infoWindow&&t.infoWindow.close()};this.removeMarker=function(e){for(var t=0;t<this.markers.length;t++)if(this.markers[t]===e){this.markers[t].setMap(null);this.markers.splice(t,1);r.fire("marker_removed",e,this);break}return e};this.removeMarkers=function(e){var e=e||this.markers;for(var t=0;t<this.markers.length;t++)this.markers[t]===e[t]&&this.markers[t].setMap(null);var n=[];for(var t=0;t<this.markers.length;t++)this.markers[t].getMap()!=null&&n.push(this.markers[t]);this.markers=n};this.drawOverlay=function(e){var n=new google.maps.OverlayView;n.setMap(i.map);var r=!0;e.auto_show!=null&&(r=e.auto_show);n.onAdd=function(){var r=t.createElement("div");r.style.borderStyle="none";r.style.borderWidth="0px";r.style.position="absolute";r.style.zIndex=100;r.innerHTML=e.content;n.el=r;var i=this.getPanes();e.layer||(e.layer="overlayLayer");var s=i[e.layer];s.appendChild(r);var o=["contextmenu","DOMMouseScroll","dblclick","mousedown"];for(var u=0;u<o.length;u++)(function(e,t){google.maps.event.addDomListener(e,t,function(e){if(navigator.userAgent.toLowerCase().indexOf("msie")!=-1&&document.all){e.cancelBubble=!0;e.returnValue=!1}else e.stopPropagation()})})(r,o[u]);google.maps.event.trigger(this,"ready")};n.draw=function(){var t=this.getProjection(),i=t.fromLatLngToDivPixel(new google.maps.LatLng(e.lat,e.lng));e.horizontalOffset=e.horizontalOffset||0;e.verticalOffset=e.verticalOffset||0;var s=n.el,o=s.children[0],u=o.clientHeight,a=o.clientWidth;switch(e.verticalAlign){case"top":s.style.top=i.y-u+e.verticalOffset+"px";break;default:case"middle":s.style.top=i.y-u/2+e.verticalOffset+"px";break;case"bottom":s.style.top=i.y+e.verticalOffset+"px"}switch(e.horizontalAlign){case"left":s.style.left=i.x-a+e.horizontalOffset+"px";break;default:case"center":s.style.left=i.x-a/2+e.horizontalOffset+"px";break;case"right":s.style.left=i.x+e.horizontalOffset+"px"}s.style.display=r?"block":"none";r||e.show.apply(this,[s])};n.onRemove=function(){var t=n.el;if(e.remove)e.remove.apply(this,[t]);else{n.el.parentNode.removeChild(n.el);n.el=null}};i.overlays.push(n);return n};this.removeOverlay=function(e){for(var t=0;t<this.overlays.length;t++)if(this.overlays[t]===e){this.overlays[t].setMap(null);this.overlays.splice(t,1);break}};this.removeOverlays=function(){for(var e=0,t;t=i.overlays[e];e++)t.setMap(null);i.overlays=[]};this.drawPolyline=function(e){var t=[],n=e.path;if(n.length)if(n[0][0]===undefined)t=n;else for(var i=0,s;s=n[i];i++)t.push(new google.maps.LatLng(s[0],s[1]));var o={map:this.map,path:t,strokeColor:e.strokeColor,strokeOpacity:e.strokeOpacity,strokeWeight:e.strokeWeight,geodesic:e.geodesic,clickable:!0,editable:!1,visible:!0};e.hasOwnProperty("clickable")&&(o.clickable=e.clickable);e.hasOwnProperty("editable")&&(o.editable=e.editable);e.hasOwnProperty("icons")&&(o.icons=e.icons);e.hasOwnProperty("zIndex")&&(o.zIndex=e.zIndex);var u=new google.maps.Polyline(o),a=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var f=0;f<a.length;f++)(function(t,n){google.maps.event.addListener(t,n,function(t){e[n]&&e[n].apply(this,[t])})})(u,a[f]);this.polylines.push(u);r.fire("polyline_added",u,this);return u};this.removePolyline=function(e){for(var t=0;t<this.polylines.length;t++)if(this.polylines[t]===e){this.polylines[t].setMap(null);this.polylines.splice(t,1);r.fire("polyline_removed",e,this);break}};this.removePolylines=function(){for(var e=0,t;t=i.polylines[e];e++)t.setMap(null);i.polylines=[]};this.drawCircle=function(e){e=extend_object({map:this.map,center:new google.maps.LatLng(e.lat,e.lng)},e);delete e.lat;delete e.lng;var t=new google.maps.Circle(e),n=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var r=0;r<n.length;r++)(function(t,n){google.maps.event.addListener(t,n,function(t){e[n]&&e[n].apply(this,[t])})})(t,n[r]);this.polygons.push(t);return t};this.drawRectangle=function(e){e=extend_object({map:this.map},e);var t=new google.maps.LatLngBounds(new google.maps.LatLng(e.bounds[0][0],e.bounds[0][1]),new google.maps.LatLng(e.bounds[1][0],e.bounds[1][1]));e.bounds=t;var n=new google.maps.Rectangle(e),r=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var i=0;i<r.length;i++)(function(t,n){google.maps.event.addListener(t,n,function(t){e[n]&&e[n].apply(this,[t])})})(n,r[i]);this.polygons.push(n);return n};this.drawPolygon=function(e){var t=!1;e.hasOwnProperty("useGeoJSON")&&(t=e.useGeoJSON);delete e.useGeoJSON;e=extend_object({map:this.map},e);t==0&&(e.paths=[e.paths.slice(0)]);e.paths.length>0&&e.paths[0].length>0&&(e.paths=array_flat(array_map(e.paths,arrayToLatLng,t)));var n=new google.maps.Polygon(e),i=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var s=0;s<i.length;s++)(function(t,n){google.maps.event.addListener(t,n,function(t){e[n]&&e[n].apply(this,[t])})})(n,i[s]);this.polygons.push(n);r.fire("polygon_added",n,this);return n};this.removePolygon=function(e){for(var t=0;t<this.polygons.length;t++)if(this.polygons[t]===e){this.polygons[t].setMap(null);this.polygons.splice(t,1);r.fire("polygon_removed",e,this);break}};this.removePolygons=function(){for(var e=0,t;t=i.polygons[e];e++)t.setMap(null);i.polygons=[]};this.getFromFusionTables=function(e){var t=e.events;delete e.events;var n=e,r=new google.maps.FusionTablesLayer(n);for(var i in t)(function(e,n){google.maps.event.addListener(e,n,function(e){t[n].apply(this,[e])})})(r,i);this.layers.push(r);return r};this.loadFromFusionTables=function(e){var t=this.getFromFusionTables(e);t.setMap(this.map);return t};this.getFromKML=function(e){var t=e.url,n=e.events;delete e.url;delete e.events;var r=e,i=new google.maps.KmlLayer(t,r);for(var s in n)(function(e,t){google.maps.event.addListener(e,t,function(e){n[t].apply(this,[e])})})(i,s);this.layers.push(i);return i};this.loadFromKML=function(e){var t=this.getFromKML(e);t.setMap(this.map);return t};var M,_;this.getRoutes=function(e){switch(e.travelMode){case"bicycling":M=google.maps.TravelMode.BICYCLING;break;case"transit":M=google.maps.TravelMode.TRANSIT;break;case"driving":M=google.maps.TravelMode.DRIVING;break;default:M=google.maps.TravelMode.WALKING}e.unitSystem==="imperial"?_=google.maps.UnitSystem.IMPERIAL:_=google.maps.UnitSystem.METRIC;var t={avoidHighways:!1,avoidTolls:!1,optimizeWaypoints:!1,waypoints:[]},n=extend_object(t,e);n.origin=/string/.test(typeof e.origin)?e.origin:new google.maps.LatLng(e.origin[0],e.origin[1]);n.destination=new google.maps.LatLng(e.destination[0],e.destination[1]);n.travelMode=M;n.unitSystem=_;delete n.callback;var r=this,i=new google.maps.DirectionsService;i.route(n,function(t,n){if(n===google.maps.DirectionsStatus.OK)for(var i in t.routes)t.routes.hasOwnProperty(i)&&r.routes.push(t.routes[i]);e.callback&&e.callback(r.routes)})};this.removeRoutes=function(){this.routes=[]};this.getElevations=function(e){e=extend_object({locations:[],path:!1,samples:256},e);e.locations.length>0&&e.locations[0].length>0&&(e.locations=array_flat(array_map([e.locations],arrayToLatLng,!1)));var t=e.callback;delete e.callback;var n=new google.maps.ElevationService;if(!e.path){delete e.path;delete e.samples;n.getElevationForLocations(e,function(e,n){t&&typeof t=="function"&&t(e,n)})}else{var r={path:e.locations,samples:e.samples};n.getElevationAlongPath(r,function(e,n){t&&typeof t=="function"&&t(e,n)})}};this.cleanRoute=this.removePolylines;this.drawRoute=function(e){var t=this;this.getRoutes({origin:e.origin,destination:e.destination,travelMode:e.travelMode,waypoints:e.waypoints,unitSystem:e.unitSystem,callback:function(n){if(n.length>0){t.drawPolyline({path:n[n.length-1].overview_path,strokeColor:e.strokeColor,strokeOpacity:e.strokeOpacity,strokeWeight:e.strokeWeight});e.callback&&e.callback(n[n.length-1])}}})};this.travelRoute=function(e){if(e.origin&&e.destination)this.getRoutes({origin:e.origin,destination:e.destination,travelMode:e.travelMode,waypoints:e.waypoints,callback:function(t){t.length>0&&e.start&&e.start(t[t.length-1]);if(t.length>0&&e.step){var n=t[t.length-1];if(n.legs.length>0){var r=n.legs[0].steps;for(var i=0,s;s=r[i];i++){s.step_number=i;e.step(s,n.legs[0].steps.length-1)}}}t.length>0&&e.end&&e.end(t[t.length-1])}});else if(e.route&&e.route.legs.length>0){var t=e.route.legs[0].steps;for(var n=0,r;r=t[n];n++){r.step_number=n;e.step(r)}}};this.drawSteppedRoute=function(e){if(e.origin&&e.destination)this.getRoutes({origin:e.origin,destination:e.destination,travelMode:e.travelMode,waypoints:e.waypoints,callback:function(t){t.length>0&&e.start&&e.start(t[t.length-1]);if(t.length>0&&e.step){var n=t[t.length-1];if(n.legs.length>0){var r=n.legs[0].steps;for(var s=0,o;o=r[s];s++){o.step_number=s;i.drawPolyline({path:o.path,strokeColor:e.strokeColor,strokeOpacity:e.strokeOpacity,strokeWeight:e.strokeWeight});e.step(o,n.legs[0].steps.length-1)}}}t.length>0&&e.end&&e.end(t[t.length-1])}});else if(e.route&&e.route.legs.length>0){var t=e.route.legs[0].steps;for(
var n=0,r;r=t[n];n++){r.step_number=n;i.drawPolyline({path:r.path,strokeColor:e.strokeColor,strokeOpacity:e.strokeOpacity,strokeWeight:e.strokeWeight});e.step(r)}}};this.checkGeofence=function(e,t,n){return n.containsLatLng(new google.maps.LatLng(e,t))};this.checkMarkerGeofence=function(e,t){if(e.fences)for(var n=0,r;r=e.fences[n];n++){var s=e.getPosition();i.checkGeofence(s.lat(),s.lng(),r)||t(e,r)}};this.addLayer=function(e,t){t=t||{};var n;switch(e){case"weather":this.singleLayers.weather=n=new google.maps.weather.WeatherLayer;break;case"clouds":this.singleLayers.clouds=n=new google.maps.weather.CloudLayer;break;case"traffic":this.singleLayers.traffic=n=new google.maps.TrafficLayer;break;case"transit":this.singleLayers.transit=n=new google.maps.TransitLayer;break;case"bicycling":this.singleLayers.bicycling=n=new google.maps.BicyclingLayer;break;case"panoramio":this.singleLayers.panoramio=n=new google.maps.panoramio.PanoramioLayer;n.setTag(t.filter);delete t.filter;t.click&&google.maps.event.addListener(n,"click",function(e){t.click(e);delete t.click});break;case"places":this.singleLayers.places=n=new google.maps.places.PlacesService(this.map);if(t.search||t.nearbySearch){var r={bounds:t.bounds||null,keyword:t.keyword||null,location:t.location||null,name:t.name||null,radius:t.radius||null,rankBy:t.rankBy||null,types:t.types||null};t.search&&n.search(r,t.search);t.nearbySearch&&n.nearbySearch(r,t.nearbySearch)}if(t.textSearch){var i={bounds:t.bounds||null,location:t.location||null,query:t.query||null,radius:t.radius||null};n.textSearch(i,t.textSearch)}}if(n!==undefined){typeof n.setOptions=="function"&&n.setOptions(t);typeof n.setMap=="function"&&n.setMap(this.map);return n}};this.removeLayer=function(e){if(this.singleLayers[e]!==undefined){this.singleLayers[e].setMap(null);delete this.singleLayers[e]}};this.toImage=function(e){var e=e||{},t={};t.size=e.size||[this.el.clientWidth,this.el.clientHeight];t.lat=this.getCenter().lat();t.lng=this.getCenter().lng();if(this.markers.length>0){t.markers=[];for(var n=0;n<this.markers.length;n++)t.markers.push({lat:this.markers[n].getPosition().lat(),lng:this.markers[n].getPosition().lng()})}if(this.polylines.length>0){var i=this.polylines[0];t.polyline={};t.polyline.path=google.maps.geometry.encoding.encodePath(i.getPath());t.polyline.strokeColor=i.strokeColor;t.polyline.strokeOpacity=i.strokeOpacity;t.polyline.strokeWeight=i.strokeWeight}return r.staticMapURL(t)};this.addMapType=function(e,t){if(!t.hasOwnProperty("getTileUrl")||typeof t["getTileUrl"]!="function")throw"'getTileUrl' function required.";t.tileSize=t.tileSize||new google.maps.Size(256,256);var n=new google.maps.ImageMapType(t);this.map.mapTypes.set(e,n)};this.addOverlayMapType=function(e){if(!e.hasOwnProperty("getTile")||typeof e["getTile"]!="function")throw"'getTile' function required.";var t=e.index;delete e.index;this.map.overlayMapTypes.insertAt(t,e)};this.removeOverlayMapType=function(e){this.map.overlayMapTypes.removeAt(e)};this.addStyle=function(e){var t=new google.maps.StyledMapType(e.styles,e.styledMapName);this.map.mapTypes.set(e.mapTypeId,t)};this.setStyle=function(e){this.map.setMapTypeId(e)};this.createPanorama=function(e){if(!e.hasOwnProperty("lat")||!e.hasOwnProperty("lng")){e.lat=this.getCenter().lat();e.lng=this.getCenter().lng()}this.panorama=r.createPanorama(e);this.map.setStreetView(this.panorama);return this.panorama};this.on=function(e,t){return r.on(e,this,t)};this.off=function(e){r.off(e,this)}};r.createPanorama=function(e){var t=n(e.el,e.context);e.position=new google.maps.LatLng(e.lat,e.lng);delete e.el;delete e.context;delete e.lat;delete e.lng;var r=["closeclick","links_changed","pano_changed","position_changed","pov_changed","resize","visible_changed"],i=extend_object({visible:!0},e);for(var s=0;s<r.length;s++)delete i[r[s]];var o=new google.maps.StreetViewPanorama(t,i);for(var s=0;s<r.length;s++)(function(t,n){e[n]&&google.maps.event.addListener(t,n,function(){e[n].apply(this)})})(o,r[s]);return o};r.Route=function(e){this.map=e.map;this.route=e.route;this.step_count=0;this.steps=this.route.legs[0].steps;this.steps_length=this.steps.length;this.polyline=this.map.drawPolyline({path:new google.maps.MVCArray,strokeColor:e.strokeColor,strokeOpacity:e.strokeOpacity,strokeWeight:e.strokeWeight}).getPath();this.back=function(){if(this.step_count>0){this.step_count--;var e=this.route.legs[0].steps[this.step_count].path;for(var t in e)e.hasOwnProperty(t)&&this.polyline.pop()}};this.forward=function(){if(this.step_count<this.steps_length){var e=this.route.legs[0].steps[this.step_count].path;for(var t in e)e.hasOwnProperty(t)&&this.polyline.push(e[t]);this.step_count++}}};r.geolocate=function(e){var t=e.always||e.complete;if(navigator.geolocation)navigator.geolocation.getCurrentPosition(function(n){e.success(n);t&&t()},function(n){e.error(n);t&&t()},e.options);else{e.not_supported();t&&t()}};r.geocode=function(e){this.geocoder=new google.maps.Geocoder;var t=e.callback;e.hasOwnProperty("lat")&&e.hasOwnProperty("lng")&&(e.latLng=new google.maps.LatLng(e.lat,e.lng));delete e.lat;delete e.lng;delete e.callback;this.geocoder.geocode(e,function(e,n){t(e,n)})};r.staticMapURL=function(e){function p(e,t){if(e[0]==="#"){e=e.replace("#","0x");if(t){t=parseFloat(t);t=Math.min(1,Math.max(t,0));if(t===0)return"0x00000000";t=(t*255).toString(16);t.length===1&&(t+=t);e=e.slice(0,8)+t}}return e}var t=[],n,r="http://maps.googleapis.com/maps/api/staticmap";if(e.url){r=e.url;delete e.url}r+="?";var i=e.markers;delete e.markers;if(!i&&e.marker){i=[e.marker];delete e.marker}var s=e.polyline;delete e.polyline;if(e.center){t.push("center="+e.center);delete e.center}else if(e.address){t.push("center="+e.address);delete e.address}else if(e.lat){t.push(["center=",e.lat,",",e.lng].join(""));delete e.lat;delete e.lng}else if(e.visible){var o=encodeURI(e.visible.join("|"));t.push("visible="+o)}var u=e.size;if(u){u.join&&(u=u.join("x"));delete e.size}else u="630x300";t.push("size="+u);e.zoom||(e.zoom=15);var a=e.hasOwnProperty("sensor")?!!e.sensor:!0;delete e.sensor;t.push("sensor="+a);for(var f in e)e.hasOwnProperty(f)&&t.push(f+"="+e[f]);if(i){var l,c;for(var h=0;n=i[h];h++){l=[];n.size&&n.size!=="normal"?l.push("size:"+n.size):n.icon&&l.push("icon:"+encodeURI(n.icon));n.color&&l.push("color:"+n.color.replace("#","0x"));n.label&&l.push("label:"+n.label[0].toUpperCase());c=n.address?n.address:n.lat+","+n.lng;if(l.length||h===0){l.push(c);l=l.join("|");t.push("markers="+encodeURI(l))}else{l=t.pop()+encodeURI("|"+c);t.push(l)}}}if(s){n=s;s=[];n.strokeWeight&&s.push("weight:"+parseInt(n.strokeWeight,10));if(n.strokeColor){var d=p(n.strokeColor,n.strokeOpacity);s.push("color:"+d)}if(n.fillColor){var v=p(n.fillColor,n.fillOpacity);s.push("fillcolor:"+v)}var m=n.path;if(m.join)for(var g=0,y;y=m[g];g++)s.push(y.join(","));else s.push("enc:"+m);s=s.join("|");t.push("path="+encodeURI(s))}t=t.join("&");return r+t};r.custom_events=["marker_added","marker_removed","polyline_added","polyline_removed","polygon_added","polygon_removed","geolocated","geolocation_failed"];r.on=function(e,t,n){if(r.custom_events.indexOf(e)==-1)return google.maps.event.addListener(t,e,n);var i={handler:n,eventName:e};t.registered_events[e]=t.registered_events[e]||[];t.registered_events[e].push(i);return i};r.off=function(e,t){r.custom_events.indexOf(e)==-1?google.maps.event.clearListeners(t,e):t.registered_events[e]=[]};r.fire=function(e,t,n){if(r.custom_events.indexOf(e)==-1)google.maps.event.trigger(t,e,Array.prototype.slice.apply(arguments).slice(2));else if(e in n.registered_events){var i=n.registered_events[e];for(var s=0;s<i.length;s++)(function(e,t,n){e.apply(t,[n])})(i[s].handler,n,t)}};google.maps.Polygon.prototype.getBounds||(google.maps.Polygon.prototype.getBounds=function(e){var t=new google.maps.LatLngBounds,n=this.getPaths(),r;for(var i=0;i<n.getLength();i++){r=n.getAt(i);for(var s=0;s<r.getLength();s++)t.extend(r.getAt(s))}return t});google.maps.Polygon.prototype.containsLatLng||(google.maps.Polygon.prototype.containsLatLng=function(e){var t=this.getBounds();if(t!==null&&!t.contains(e))return!1;var n=!1,r=this.getPaths().getLength();for(var i=0;i<r;i++){var s=this.getPaths().getAt(i),o=s.getLength(),u=o-1;for(var a=0;a<o;a++){var f=s.getAt(a),l=s.getAt(u);(f.lng()<e.lng()&&l.lng()>=e.lng()||l.lng()<e.lng()&&f.lng()>=e.lng())&&f.lat()+(e.lng()-f.lng())/(l.lng()-f.lng())*(l.lat()-f.lat())<e.lat()&&(n=!n);u=a}}return n});google.maps.LatLngBounds.prototype.containsLatLng=function(e){return this.contains(e)};google.maps.Marker.prototype.setFences=function(e){this.fences=e};google.maps.Marker.prototype.addFence=function(e){this.fences.push(e)};return r}(this),coordsToLatLngs=function(e,t){var n=e[0],r=e[1];if(t){n=e[1];r=e[0]}return new google.maps.LatLng(n,r)},arrayToLatLng=function(e,t){for(var n=0;n<e.length;n++)e[n].length>0&&typeof e[n][0]!="number"?e[n]=arrayToLatLng(e[n],t):e[n]=coordsToLatLngs(e[n],t);return e},extend_object=function(e,t){if(e===t)return e;for(var n in t)e[n]=t[n];return e},replace_object=function(e,t){if(e===t)return e;for(var n in t)e[n]!=undefined&&(e[n]=t[n]);return e},array_map=function(e,t){var n=Array.prototype.slice.call(arguments,2);if(Array.prototype.map&&e.map===Array.prototype.map)return Array.prototype.map.call(e,function(e){callback_params=n;callback_params.splice(0,0,e);return t.apply(this,callback_params)});var r=[],i=e.length;for(var s=0;s<i;s++){callback_params=n;callback_params=callback_params.splice(0,0,e[s]);r.push(t.apply(this,callback_params))}return r},array_flat=function(e){new_array=[];for(var t=0;t<e.length;t++)new_array=new_array.concat(e[t]);return new_array};$(function(){$(".openLabsList").not(".bb").remove();window.MapApp={Models:{},Collections:{},Views:{}};window.template=function(e){return _.template($("#"+e).html())};MapApp.vents=_.extend({},Backbone.Events);$("select#ellType").change(function(){MapApp.vents.trigger("filterbyType")});$("#searchTitle").on("keyup",function(){query=$(this).val();console.log(query);filteredLocations=MapApp.initialLocationsCollection.query({title:{$likeI:query}});MapApp.locationsCollection.reset(filteredLocations)});$(".reset").on("click",function(e){e.preventDefault();MapApp.resetFilters()});MapApp.filterList=[];MapApp.addLocationToMap=function(e,t,n,r){MapApp.map.addMarker({lat:t,lng:n,title:r,html:"",click:function(e){},infoWindow:{content:'<div class="popupContent">'+$("#openLabsListing #openLabsItem"+e).html()+"</div>"}});return"marker added"};MapApp.removeMarkers=function(){MapApp.map.removeMarkers()};MapApp.mapInit=function(){MapApp.map=new GMaps({div:"#map",lat:53.571148,lng:10.024898,zoom:3})};MapApp.mapInit();MapApp.readProp=function(e,t){return e[t]};MapApp.activateMultiselect=function(){$("select.multiselect").val([]);$(".multiselect").multiselect({buttonClass:"btn",buttonWidth:"auto",maxHeight:!1,buttonText:function(e,t){return e.length===0?t.attr("data-name")+'<b class="caret"></b>':e.length>0?t.attr("data-name")+" <span>"+e.length+'</span> <b class="caret"></b>':t.attr("data-name")+'<b class="caret"></b>'},onChange:function(e,t){filtername=e.parent().attr("data-name");MapApp.vents.trigger("selectChanged",e,filtername,t)}})};MapApp.resetFilters=function(){$("#searchTitle").val("");$("select.multiselect").val([]);$("select.multiselect").multiselect("refresh");MapApp.vents.trigger("selectChanged")};MapApp.Router=Backbone.Router.extend({routes:{"":"index","show/:id":"show",showAll:"showAll","add/:id/*title":"add","search/*title":"search","*other":"Default"},index:function(){},show:function(e){console.log("show:"+e);MapApp.vents.trigger("location:show",e)},showAll:function(e){MapApp.vents.trigger("location:showAll",e)},add:function(e,t){console.log("add id:"+e+" title:"+t)},search:function(e){console.log("search title:"+e)},Default:function(e){console.log("Not sure wht you tying to do: you acessed:"+e)}});MapApp.router=new MapApp.Router;Backbone.history.start();MapApp.Models.Locations=Backbone.DeepModel.extend({defaults:{lat:51.511214,lon:-0.119824,openLab:"isOpenLab",filterable:{},title:"im am the default Title",logo:"http://lorempixel.com/116/75/people/",link:"http://www.google.de"},sync:function(){return!1},validate:function(e){if(!_.isNumber(e.lat))return"lat Must not be empty";if(!_.isNumber(e.lon))return"lon Must not be empty";if(!$.trim(e.title))return"title Must not be empty"},display:function(){return this.get("title")+" is displaying"}});MapApp.Views.Location=Backbone.View.extend({tagName:"div",className:"openLabsItem",events:{click:"showLocationInMap","click strong":"showAlert","click button":"destroy"},template:template("locationTemplate"),initialize:function(){this.model.on("change",this.render,this);this.model.on("destroy",this.remove,this)},render:function(){var e=this.model.get("id");this.$el.html(this.template(this.model.toJSON())).attr("id","openLabsItem"+e);MapApp.vents.trigger("locationAdded");return this},showAlert:function(){var e=prompt("edit the Title:",this.model.get("title"));if(!e)return;this.model.set("title",e)},destroy:function(){this.model.destroy()},remove:function(){this.$el.remove()},showLocationInMap:function(){var e=this.model.get("lat"),t=this.model.get("lon");MapApp.map.setCenter(e,t);MapApp.map.setZoom(6)}});MapApp.Views.Locations=Backbone.View.extend({tagName:"div",initialize:function(){this.collection.on("add",this.addOne,this);this.collection.on("reset",this.render,this);MapApp.vents.on("filterbyType",this.startFilterType,this);MapApp.vents.on("startSearch",this.search,this)},render:function(){this.$el.html("");this.collection.each(this.addOne,this);return this},renderFiltered:function(e){$("#openLabsListing").html("");e.each(function(e){var t=new MapApp.Views.Location({model:e,collection:this.collection});$("#openLabsListing").append(t.render().el)});return this},addOne:function(e){var t=new MapApp.Views.Location({model:e});this.$el.append(t.render().el)},startFilterType:function(){var e=$("#ellType").find("option:selected").val()}});MapApp.Views.Filter=Backbone.View.extend({tagName:"select",className:"span2 multiselect",template:template("filterTemplate"),initialize:function(){this.$el.attr("data-name",MapApp.filterList[this.options.index])},render:function(){this.renderFilters();this.renderallOptions()},renderFilters:function(){var e=MapApp.filterList[this.options.index]},renderallOptions:function(){var e=MapApp.optionsCollection.at(this.options.index).get("filteroptions");MapApp["filterOptionsArray"+this.options.index]=[];_.each(e,function(e,t){_.each(e,function(e,t){MapApp["filterOptionsArray"+this.options.index].push(e)},this)},this);MapApp["filterOptionsArray"+this.options.index]=_.uniq(MapApp["filterOptionsArray"+this.options.index]);_.each(MapApp["filterOptionsArray"+this.options.index],function(e){this.$el.append(this.template({optionName:e}))},this)}});MapApp.Views.Filters=Backbone.View.extend({tagName:"div",className:"filters",initialize:function(){MapApp.vents.on("selectChanged",this.updateQueryObject,this);this.collection.on("reset",this.update,this);this.create()},create:function(){this.createFilterList();this.createOptionsLists();this.render();MapApp.activateMultiselect()},update:function(){this.createOptionsLists()},createFilterList:function(){MapApp.filterList=[];this.collection.each(function(e){var t=e.get("filterable");for(var n in t)MapApp.filterList.push(n)});MapApp.filterList=_.uniq(MapApp.filterList)},createOptionsLists:function(){MapApp.optionsLists={};MapApp.optionsCollection.reset();_.each(MapApp.filterList,function(e,t){MapApp.optionsCollection.add({});MapApp.optionsCollection.at(t).set("filtername",e);var n=[];MapApp.locationsCollection.each(function(t){var r=t.get("filterable")[e];n.push(r)});MapApp.optionsCollection.at(t).set("filteroptions",n)})},render:function(){this.$el.html("");_.each(MapApp.filterList,function(e,t){MapApp.filterView=new MapApp.Views.Filter({index:t});MapApp.filterView.render();this.$el.append(MapApp.filterView.el)},this);return this},updateQueryObject:function(){MapApp.queryObject={};$("select.multiselect").each(function(){filtername="filterable."+$(this).attr("data-name");selected={$all:$(this).val()};if($(this).val()==null)return;MapApp.queryObject[filtername]=selected});console.log("##################");console.log("THE COLLECTION IS:");console.log(MapApp.locationsCollection);console.log("THE QUERY OBJECT IS: ");console.log(MapApp.queryObject);filteredLocations=MapApp.initialLocationsCollection.query(MapApp.queryObject);console.log("THE RESULT IS: ");console.log(filteredLocations);MapApp.locationsCollection.reset(filteredLocations)}});MapApp.Views.Map=Backbone.View.extend({el:"#mapActions",events:{"click #showAll":"showAll","click #removeAll":"removeAll"},initialize:function(){MapApp.vents.on("location:showAll",this.showAll,this);MapApp.vents.on("locationAdded",this.showAll,this);this.collection.on("add",this.showAll,this);this.collection.on("remove",this.showAll,this);this.collection.on("reset",this.showAll,this);this.showAll()},showAll:function(){console.log("Showing Markers");this.removeAll();this.collection.each(this.addLocation,this);this.collection.length!=0?MapApp.map.fitZoom():MapApp.mapInit()},removeAll:function(){MapApp.removeMarkers()},addLocation:function(e){var t=e.get("lat"),n=e.get("lon"),r=e.get("title"),i=e.get("logo"),s=e.get("id"),o=e.get("nationalCLC"),u=e.get("actionLines"),a=e.get("eLLType"),f=e.get("link");MapApp.addLocationToMap(s,t,n,r)},destroyMarker:function(e){this.model.destroy()},remove:function(){this.$el.remove()}});MapApp.Collections.Locations=Backbone.QueryCollection.extend({model:MapApp.Models.Locations});MapApp.Models.option=Backbone.Model.extend({defaults:{filtername:"Filtername",filteroptions:"[1,2,3,4]"}});MapApp.Collections.Options=Backbone.QueryCollection.extend({model:MapApp.Models.option});MapApp.optionsCollection=new MapApp.Collections.Options([]);MapApp.locationsCollection=new MapApp.Collections.Locations(places);MapApp.initialLocationsCollection=new MapApp.Collections.Locations(MapApp.locationsCollection.toJSON());MapApp.filterView=new MapApp.Views.Filter({model:MapApp.Models.Locations});MapApp.filtersView=new MapApp.Views.Filters({collection:MapApp.locationsCollection});$("#filterLocations").prepend(MapApp.filtersView.el);MapApp.locationsView=new MapApp.Views.Locations({collection:MapApp.locationsCollection});$("#openLabsListing").append(MapApp.locationsView.render().el);new MapApp.Views.Map({collection:MapApp.locationsCollection});MapApp.activateMultiselect()});